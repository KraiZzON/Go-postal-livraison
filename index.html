<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Suivi de Commande</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: system-ui, -apple-system, sans-serif; }
    </style>
</head>
<body>
    <div id="app"></div>

    <script>
        // Configuration Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyDxvLw4S3npQIUYS72uk6xtcJ-bImGPiQI",
            authDomain: "go-postal-96c85.firebaseapp.com",
            databaseURL: "https://go-postal-96c85-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "go-postal-96c85",
            storageBucket: "go-postal-96c85.firebasestorage.app",
            messagingSenderId: "632274389956",
            appId: "1:632274389956:web:5330031c5b36b7c97df291"
        };

        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        class TrackingApp {
            constructor() {
                this.trackingNumber = '';
                this.currentOrder = null;
                
                this.statuses = [
                    { key: 'received', label: 'Commande re√ßue', icon: '‚è∞', color: 'gray' },
                    { key: 'preparing', label: 'En pr√©paration', icon: 'üì¶', color: 'blue' },
                    { key: 'delivering', label: 'En cours de livraison', icon: 'üöö', color: 'orange' },
                    { key: 'delivered', label: 'Livr√©e', icon: '‚úÖ', color: 'green' }
                ];
                
                this.render();
            }

            async trackOrder() {
                const orderId = this.trackingNumber.trim();
                
                if (!orderId) {
                    alert('‚ö†Ô∏è Veuillez entrer un num√©ro de commande');
                    return;
                }

                try {
                    const snapshot = await database.ref('orders/' + orderId).once('value');
                    const order = snapshot.val();
                    
                    if (order) {
                        this.currentOrder = order;
                        this.render();
                    } else {
                        alert('‚ùå Num√©ro de commande introuvable. V√©rifiez votre num√©ro.');
                        this.currentOrder = null;
                        this.render();
                    }
                } catch (error) {
                    alert('‚ùå Erreur lors de la recherche. R√©essayez.');
                    console.error(error);
                }
            }

            getStatusIndex(status) {
                return this.statuses.findIndex(s => s.key === status);
            }

            renderOrderTracking() {
                if (!this.currentOrder) return '';
                
                const currentIndex = this.getStatusIndex(this.currentOrder.status);
                
                const steps = this.statuses.map((status, index) => {
                    const isActive = index <= currentIndex;
                    const isCurrent = index === currentIndex;
                    
                    return `
                        <div class="relative">
                            ${index < this.statuses.length - 1 ? `
                                <div class="absolute left-6 top-14 w-1 h-16 ${index < currentIndex ? 'bg-green-500' : 'bg-gray-200'}"></div>
                            ` : ''}
                            <div class="flex items-start gap-4">
                                <div class="w-12 h-12 rounded-full flex items-center justify-center transition-all text-2xl
                                    ${isActive ? 'bg-green-500 text-white shadow-lg scale-110' : 'bg-gray-200'}
                                    ${isCurrent ? 'ring-4 ring-green-200' : ''}">
                                    ${status.icon}
                                </div>
                                <div class="flex-1 pt-2">
                                    <h3 class="font-semibold text-lg ${isActive ? 'text-gray-800' : 'text-gray-400'}">
                                        ${status.label}
                                    </h3>
                                    ${isCurrent ? '<p class="text-sm text-green-600 font-medium mt-1">üìç Statut actuel</p>' : ''}
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');

                return `
                    <div class="space-y-8 mt-8 animate-fadeIn">
                        <div class="text-center bg-green-50 rounded-lg p-6 border-2 border-green-200">
                            <div class="text-4xl mb-3">üì¶</div>
                            <h2 class="text-2xl font-bold text-gray-800 mb-2">Commande ${this.currentOrder.id}</h2>
                            <p class="text-gray-600 font-medium">${this.currentOrder.customerName}</p>
                        </div>
                        <div class="space-y-6">${steps}</div>
                        <div class="text-center text-sm text-gray-500 pt-4 border-t">
                            üìÖ Derni√®re mise √† jour : ${new Date(this.currentOrder.updatedAt).toLocaleString('fr-FR')}
                        </div>
                    </div>
                `;
            }

            render() {
                const app = document.getElementById('app');
                
                app.innerHTML = `
                    <div class="min-h-screen bg-gradient-to-br from-green-50 to-teal-100 p-4">
                        <div class="max-w-3xl mx-auto py-8">
                            <div class="bg-white rounded-2xl shadow-2xl p-8">
                                <div class="text-center mb-8">
                                    <div class="text-6xl mb-4">üöö</div>
                                    <h1 class="text-4xl font-bold text-gray-800 mb-2">Suivi de Commande</h1>
                                    <p class="text-gray-600">Entrez votre num√©ro pour suivre votre livraison</p>
                                </div>

                                <div class="mb-8">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        Num√©ro de commande
                                    </label>
                                    <div class="flex gap-2">
                                        <input type="text" id="trackingInput" placeholder="Ex: CMD1734567890123"
                                            class="flex-1 px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 transition text-lg"
                                            value="${this.trackingNumber}">
                                        <button id="btnTrack"
                                            class="px-8 py-3 bg-green-600 text-white rounded-lg font-semibold hover:bg-green-700 transition shadow-lg hover:shadow-xl text-lg">
                                            Suivre
                                        </button>
                                    </div>
                                    <p class="text-xs text-gray-500 mt-2">
                                        üí° Entrez le num√©ro de commande qui vous a √©t√© fourni
                                    </p>
                                </div>

                                ${this.currentOrder ? this.renderOrderTracking() : `
                                    <div class="text-center py-12 text-gray-400">
                                        <div class="text-6xl mb-4">üìã</div>
                                        <p class="text-lg">Entrez votre num√©ro de commande ci-dessus</p>
                                    </div>
                                `}
                            </div>
                            
                            <div class="text-center mt-6 text-sm text-gray-600">
                                <p>Besoin d'aide ? Contactez le service client</p>
                            </div>
                        </div>
                    </div>

                    <style>
                        @keyframes fadeIn {
                            from { opacity: 0; transform: translateY(20px); }
                            to { opacity: 1; transform: translateY(0); }
                        }
                        .animate-fadeIn {
                            animation: fadeIn 0.5s ease-out;
                        }
                    </style>
                `;

                const trackInput = document.getElementById('trackingInput');
                const btnTrack = document.getElementById('btnTrack');

                if (trackInput && btnTrack) {
                    trackInput.addEventListener('input', (e) => {
                        this.trackingNumber = e.target.value;
                    });

                    trackInput.addEventListener('keypress', (e) => {
                        if (e.key === 'Enter') {
                            this.trackOrder();
                        }
                    });

                    btnTrack.onclick = () => {
                        this.trackOrder();
                    };
                }
            }
        }

        const app = new TrackingApp();
    </script>
</body>
</html>
